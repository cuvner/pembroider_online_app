<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>PEmbroider</title>
</head>

<body>
<h2>PEmbroider</h2>

<input type="file" id="files" multiple accept="image/png">
<button id="go">Generate</button>

<pre id="log"></pre>

<script>
let ACCESS_KEY = localStorage.getItem("pembroider_key");

if (!ACCESS_KEY) {
  ACCESS_KEY = prompt("Enter class access key:");
  if (ACCESS_KEY) localStorage.setItem("pembroider_key", ACCESS_KEY);
}

const log = document.getElementById("log");
const filesInput = document.getElementById("files");

document.getElementById("go").onclick = async () => {
  log.textContent = "Uploadingâ€¦";

  const fd = new FormData();
  for (const f of filesInput.files) fd.append("files", f);

  // minimal spec for now
  fd.append("spec", JSON.stringify({ layers: [] }));

  try {
    const r = await fetch("/api/jobs", {
      method: "POST",
      body: fd,
      headers: {
        "x-access-key": ACCESS_KEY
      }
    });

    const j = await r.json();

    if (!r.ok) throw new Error(j.error || "Request failed");

    log.textContent = "Job created:\n" + JSON.stringify(j, null, 2);
  } catch (e) {
    log.textContent = "ERROR: " + e.message;
    localStorage.removeItem("pembroider_key");
  }
};
</script>

</body>
</html>

